<?xml version="1.0" encoding="UTF-8"?>
<!--
  ================================================================================
  RECURRING DONATION PROFILE PAGE
  ================================================================================

  Displays detailed information about a single recurring donation:
  - Header with donor info and status
  - Subscription details (amount, frequency, dates)
  - Charge history timeline
  - Management actions (pause, resume, cancel)

  Route: /admin/finance/donations/recurring/[donationId]
  ================================================================================
-->
<PageDefinition
  kind="blueprint"
  module="admin-finance"
  route="donations/recurring/profile"
  schemaVersion="1.0.0"
  contentVersion="1.0.0"
  featureCode="donations.core"
  requiredPermissions="donations:view"
  locale="en-US">

  <Page id="admin-finance-donations-recurring-profile">
    <Title>Recurring Donation Details</Title>

    <Regions>
      <Region id="main">
        <!-- Profile Header -->
        <Component id="profile-header" type="ProfileHeader">
          <Props>
            <Prop name="eyebrow" kind="binding" contract="profileHeader.eyebrow"/>
            <Prop name="title" kind="binding" contract="profileHeader.title"/>
            <Prop name="subtitle" kind="binding" contract="profileHeader.subtitle"/>
            <Prop name="badge" kind="binding" contract="profileHeader.badge"/>
            <Prop name="metrics" kind="binding" contract="profileHeader.metrics"/>
          </Props>
        </Component>

        <!-- Subscription Details Panels -->
        <Component id="subscription-details" type="AdminDetailPanels">
          <Props>
            <Prop name="panels" kind="binding" contract="subscriptionDetails.panels"/>
          </Props>
        </Component>

        <!-- Charge History Timeline -->
        <Component id="charge-history" type="Timeline">
          <Props>
            <Prop name="title" kind="static">Charge History</Prop>
            <Prop name="items" kind="binding" contract="chargeHistory.items"/>
            <Prop name="emptyMessage" kind="static">No charges recorded yet</Prop>
          </Props>
        </Component>
      </Region>
    </Regions>

    <!-- Data Sources -->
    <DataSources>
      <!-- Profile header data -->
      <DataSource id="profileHeader" kind="service">
        <Contract>
          <Field name="eyebrow" path="eyebrow"/>
          <Field name="title" path="title"/>
          <Field name="subtitle" path="subtitle"/>
          <Field name="badge" path="badge"/>
          <Field name="metrics" path="metrics"/>
        </Contract>
        <Config>
          <Handler>admin-finance.donations.recurring.profile.header</Handler>
        </Config>
      </DataSource>

      <!-- Subscription details panels -->
      <DataSource id="subscriptionDetails" kind="service">
        <Contract>
          <Field name="panels" path="panels"/>
        </Contract>
        <Config>
          <Handler>admin-finance.donations.recurring.profile.details</Handler>
        </Config>
      </DataSource>

      <!-- Charge history timeline -->
      <DataSource id="chargeHistory" kind="service">
        <Contract>
          <Field name="items" path="items"/>
        </Contract>
        <Config>
          <Handler>admin-finance.donations.recurring.profile.chargeHistory</Handler>
        </Config>
      </DataSource>
    </DataSources>

    <!-- Page Actions -->
    <Actions>
      <Action id="back-to-list" kind="link">
        <Config>
          <Label>Back to Recurring Donations</Label>
          <Url>/admin/finance/donations/recurring</Url>
          <Variant>secondary</Variant>
          <Icon>arrow-left</Icon>
        </Config>
      </Action>

      <Action id="pause-subscription" kind="api">
        <RBAC requirePermissions="donations:update"/>
        <Config>
          <Label>Pause Subscription</Label>
          <Url>/api/donations/recurring/{{donationId}}/pause</Url>
          <Method>POST</Method>
          <Variant>secondary</Variant>
          <Icon>pause</Icon>
          <ConfirmMessage>Are you sure you want to pause this recurring donation?</ConfirmMessage>
          <SuccessMessage>Recurring donation paused successfully</SuccessMessage>
          <ShowWhen>status === 'active'</ShowWhen>
        </Config>
      </Action>

      <Action id="resume-subscription" kind="api">
        <RBAC requirePermissions="donations:update"/>
        <Config>
          <Label>Resume Subscription</Label>
          <Url>/api/donations/recurring/{{donationId}}/resume</Url>
          <Method>POST</Method>
          <Variant>primary</Variant>
          <Icon>play</Icon>
          <ConfirmMessage>Are you sure you want to resume this recurring donation?</ConfirmMessage>
          <SuccessMessage>Recurring donation resumed successfully</SuccessMessage>
          <ShowWhen>status === 'paused'</ShowWhen>
        </Config>
      </Action>

      <Action id="cancel-subscription" kind="api">
        <RBAC requirePermissions="donations:update"/>
        <Config>
          <Label>Cancel Subscription</Label>
          <Url>/api/donations/recurring/{{donationId}}/cancel</Url>
          <Method>POST</Method>
          <Variant>danger</Variant>
          <Icon>x-circle</Icon>
          <ConfirmMessage>Are you sure you want to permanently cancel this recurring donation? This action cannot be undone.</ConfirmMessage>
          <SuccessMessage>Recurring donation cancelled</SuccessMessage>
          <ShowWhen>status !== 'cancelled'</ShowWhen>
        </Config>
      </Action>
    </Actions>
  </Page>
</PageDefinition>
