<?xml version="1.0" encoding="UTF-8"?>
<PageDefinition
  kind="blueprint"
  module="admin-community"
  route="members/list"
  schemaVersion="1.0.0"
  contentVersion="1.1.0"
  locale="en-US"
>
  <Page id="admin-community-membership-list">
    <Title>Membership directory</Title>
    <Regions>
      <Region id="main">
        <Component id="list-hero" type="HeroSection">
          <Props>
            <Prop name="variant" kind="static">stats-panel</Prop>
            <Prop name="eyebrow" kind="binding" source="listHero" path="eyebrow" />
            <Prop name="headline" kind="binding" source="listHero" path="headline" />
            <Prop name="description" kind="binding" source="listHero" path="description" />
            <Prop name="metrics" kind="binding" source="listHero" path="metrics" />
            <Prop name="primaryCta" kind="action" actionId="launch-new-member" />
            <Prop name="secondaryCta" kind="action" actionId="open-dashboard" />
          </Props>
        </Component>
        <Component id="list-segments" type="AdminMetricCards">
          <Props>
            <Prop name="title" kind="static">Engagement segments</Prop>
            <Prop name="description" kind="static">Spotlight the pathways that need the most shepherding this week.</Prop>
            <Prop name="metrics" kind="binding" source="segmentHealth" path="items" />
          </Props>
        </Component>
        <Component id="membership-grid" type="AdminDataGridSection">
          <Props>
            <Prop name="title" kind="static">Community roster</Prop>
            <Prop name="description" kind="static">Search, filter, and update member records with finance and pastoral context at your fingertips.</Prop>
            <Prop name="rows" kind="binding" source="membersTable" path="rows" />
            <Prop name="columns" kind="binding" source="membersTable" path="columns" />
            <Prop name="filters" kind="binding" source="membersTable" path="filters" />
            <Prop name="actions" kind="binding" source="membersTable" path="actions" />
            <Prop name="emptyState" kind="static">{"title": "No members match your filters", "description": "Try expanding your filters to include additional campuses or membership stages."}</Prop>
          </Props>
        </Component>
      </Region>
    </Regions>
    <DataSources>
      <DataSource id="listHero" kind="static">
        <Json><![CDATA[
          {
            "eyebrow": "Membership operations",
            "headline": "A unified directory for discipleship, finances, and care",
            "description": "Filter members by campus, stage, and giving rhythm. Launch pastoral follow-ups or finance workflows from one table.",
            "metrics": [
              { "label": "Households", "value": "1,284", "caption": "Directory synced nightly from Planning Center." },
              { "label": "New this month", "value": "58", "caption": "Guests currently in assimilation pipeline." },
              { "label": "Recurring givers", "value": "612", "caption": "Active automated giving schedules." }
            ]
          }
        ]]></Json>
      </DataSource>
      <DataSource id="segmentHealth" kind="static">
        <Json><![CDATA[
          {
            "items": [
              {
                "id": "segment-guests",
                "label": "First-time guests scheduled",
                "value": "31",
                "change": "+9", "changeLabel": "follow-up calls", "trend": "up", "tone": "positive",
                "description": "Hospitality team coordinating welcome brunch invitations."
              },
              {
                "id": "segment-classes",
                "label": "Membership class seats",
                "value": "120",
                "change": "82%", "changeLabel": "capacity filled", "trend": "up", "tone": "informative",
                "description": "Next covenant class launches November 3rd across two campuses."
              },
              {
                "id": "segment-care",
                "label": "Care escalations",
                "value": "18",
                "change": "5 urgent", "changeLabel": "needs pastoral visits", "trend": "flat", "tone": "neutral",
                "description": "Assign shepherds to coordinate meals, prayer, and benevolence support."
              }
            ]
          }
        ]]></Json>
      </DataSource>
      <DataSource id="membersTable" kind="service">
        <Json><![CDATA[
          {
            "filters": [
              {
                "id": "query",
                "type": "search",
                "placeholder": "Search name, household, or email",
                "fields": ["name", "household", "email", "phone"]
              },
              {
                "id": "status",
                "type": "select",
                "label": "Membership stage",
                "placeholder": "All stages",
                "defaultValue": "all",
                "field": "statusKey",
                "options": [
                  { "label": "All stages", "value": "all" },
                  { "label": "Active", "value": "active" },
                  { "label": "New here", "value": "new" },
                  { "label": "Shepherding", "value": "care" },
                  { "label": "Inactive", "value": "inactive" }
                ]
              },
              {
                "id": "campus",
                "type": "select",
                "label": "Campus",
                "placeholder": "All campuses",
                "defaultValue": "all",
                "field": "campusKey",
                "options": [
                  { "label": "All campuses", "value": "all" },
                  { "label": "Downtown", "value": "downtown" },
                  { "label": "Northside", "value": "northside" },
                  { "label": "Southridge", "value": "southridge" },
                  { "label": "Online", "value": "online" }
                ]
              }
            ],
            "actions": [
              {
                "id": "add-member-action",
                "kind": "link",
                "config": { "label": "Add member", "url": "/admin/members/manage", "variant": "primary" }
              }
            ],
            "columns": [
              {
                "field": "name",
                "headerName": "Member",
                "type": "link",
                "hrefTemplate": "/admin/members/{{id}}",
                "subtitleField": "membershipLabel",
                "flex": 1.2
              },
              {
                "field": "campus",
                "headerName": "Campus",
                "flex": 0.9
              },
              {
                "field": "household",
                "headerName": "Household",
                "flex": 1
              },
              {
                "field": "status",
                "headerName": "Status",
                "type": "badge",
                "badgeVariantField": "statusVariant",
                "flex": 0.7
              },
              {
                "field": "lastEngagement",
                "headerName": "Last engagement",
                "type": "date",
                "flex": 0.8
              },
              {
                "field": "givingThisYear",
                "headerName": "YTD giving",
                "type": "currency",
                "currency": { "currency": "USD", "notation": "standard" },
                "flex": 0.8
              },
              {
                "field": "tags",
                "headerName": "Highlights",
                "type": "chip-list",
                "flex": 1.1
              },
              {
                "field": "actions",
                "headerName": "Actions",
                "type": "actions",
                "actions": [
                  {
                    "id": "view-record",
                    "label": "View",
                    "intent": "view",
                    "urlTemplate": "/admin/members/{{id}}"
                  },
                  {
                    "id": "edit-record",
                    "label": "Edit",
                    "intent": "edit",
                    "urlTemplate": "/admin/members/manage?memberId={{id}}",
                    "variant": "secondary"
                  },
                  {
                    "id": "delete-record",
                    "label": "Archive",
                    "intent": "delete",
                    "confirm": "Archive {{name}} and remove them from active rosters?",
                    "successMessage": "{{name}} was marked as archived."
                  }
                ]
              }
            ]
          }
        ]]></Json>
        <Config>
          <handler>admin-community.members.list.membersTable</handler>
          <limit>100</limit>
        </Config>
      </DataSource>
    </DataSources>
    <Actions>
      <Action id="launch-new-member" kind="link">
        <Config>
          <Label>Add new member</Label>
          <Url>/admin/members/manage</Url>
          <Variant>primary</Variant>
        </Config>
      </Action>
      <Action id="open-dashboard" kind="link">
        <Config>
          <Label>Back to dashboard</Label>
          <Url>/admin/members</Url>
          <Variant>secondary</Variant>
        </Config>
      </Action>
    </Actions>
  </Page>
</PageDefinition>
